(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{dlKe:function(t,e,i){"use strict";i.d(e,"a",function(){return D}),i.d(e,"b",function(){return K});var n=i("fXoL"),o=i("LRne"),s=i("xgIS"),r=i("5+tZ"),l=i("lJxs"),c=i("vkgz"),a=i("pLZG"),u=i("7o/Q"),h=i("D0XW");i("zx2A");const d={leading:!0,trailing:!1};class p{constructor(t,e,i,n){this.duration=t,this.scheduler=e,this.leading=i,this.trailing=n}call(t,e){return e.subscribe(new f(t,this.duration,this.scheduler,this.leading,this.trailing))}}class f extends u.a{constructor(t,e,i,n,o){super(t),this.duration=e,this.scheduler=i,this.leading=n,this.trailing=o,this._hasTrailingValue=!1,this._trailingValue=null}_next(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(g,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))}_complete(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()}clearThrottle(){const t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)}}function g(t){const{subscriber:e}=t;e.clearThrottle()}function b(t,e,i,n){const o=window&&!!window.document&&window.document.documentElement;let s=o&&e?window:i;if(t&&(s=t&&o&&"string"==typeof t?function(t,e,i){return(i?window.document:e).querySelector(t)}(t,i.nativeElement,n):t,!s))throw new Error("ngx-infinite-scroll {resolveContainerElement()}: selector for");return s}function m(t){return t&&!t.firstChange}const w={clientHeight:"clientHeight",offsetHeight:"offsetHeight",scrollHeight:"scrollHeight",pageYOffset:"pageYOffset",offsetTop:"offsetTop",scrollTop:"scrollTop",top:"top"},S={clientHeight:"clientWidth",offsetHeight:"offsetWidth",scrollHeight:"scrollWidth",pageYOffset:"pageXOffset",offsetTop:"offsetLeft",scrollTop:"scrollLeft",top:"left"};class O{constructor(t=!0){this.vertical=t,this.propsMap=t?w:S}clientHeightKey(){return this.propsMap.clientHeight}offsetHeightKey(){return this.propsMap.offsetHeight}scrollHeightKey(){return this.propsMap.scrollHeight}pageYOffsetKey(){return this.propsMap.pageYOffset}offsetTopKey(){return this.propsMap.offsetTop}scrollTopKey(){return this.propsMap.scrollTop}topKey(){return this.propsMap.top}}function x(t){return["Window","global"].some(e=>Object.prototype.toString.call(t).includes(e))}function P(t,e){return t?e.document.documentElement:null}function v(t,e){const i=function({container:t,isWindow:e,axis:i}){const{offsetHeightKey:n,clientHeightKey:o}=T(i);return y(t,e,n,o)}(e);return e.isWindow?function(t,e,i){const{axis:n,container:o,isWindow:s}=i,{offsetHeightKey:r,clientHeightKey:l}=T(n),c=t+C(P(s,o),n,s),a=y(e.nativeElement,s,r,l);return{height:t,scrolled:c,totalToScroll:function(t,e,i){const n=e.topKey();if(t.getBoundingClientRect)return t.getBoundingClientRect()[n]+C(t,e,i)}(e.nativeElement,n,s)+a,isWindow:s}}(i,t,e):function(t,e,i){const{axis:n,container:o}=i;return{height:t,scrolled:o[n.scrollTopKey()],totalToScroll:o[n.scrollHeightKey()],isWindow:!1}}(i,0,e)}function T(t){return{offsetHeightKey:t.offsetHeightKey(),clientHeightKey:t.clientHeightKey()}}function y(t,e,i,n){if(isNaN(t[i])){const i=P(e,t);return i?i[n]:0}return t[i]}function C(t,e,i){const n=e.pageYOffsetKey(),o=e.scrollTopKey(),s=e.offsetTopKey();return isNaN(window.pageYOffset)?P(i,t)[o]:t.ownerDocument?t.ownerDocument.defaultView[n]:t[s]}function _(t,e,i){let n,o;if(t.totalToScroll<=0)return!1;const s=t.isWindow?t.scrolled:t.height+t.scrolled;return i?(n=(t.totalToScroll-s)/t.totalToScroll,o=e.down/10):(n=t.scrolled/(t.scrolled+(t.totalToScroll-s)),o=e.up/10),n<=o}class M{constructor({totalToScroll:t}){this.lastScrollPosition=0,this.lastTotalToScroll=0,this.totalToScroll=0,this.triggered={down:0,up:0},this.totalToScroll=t}updateScrollPosition(t){return this.lastScrollPosition=t}updateTotalToScroll(t){this.lastTotalToScroll!==t&&(this.lastTotalToScroll=this.totalToScroll,this.totalToScroll=t)}updateScroll(t,e){this.updateScrollPosition(t),this.updateTotalToScroll(e)}updateTriggeredFlag(t,e){e?this.triggered.down=t:this.triggered.up=t}isTriggeredScroll(t,e){return e?this.triggered.down===t:this.triggered.up===t}}function k(t){const{scrollDown:e,stats:{scrolled:i}}=t;return{type:e?"[NGX_ISE] DOWN":"[NGX_ISE] UP",payload:{currentScrollPosition:i}}}let D=(()=>{class t{constructor(t,e){this.element=t,this.zone=e,this.scrolled=new n.n,this.scrolledUp=new n.n,this.infiniteScrollDistance=2,this.infiniteScrollUpDistance=1.5,this.infiniteScrollThrottle=150,this.infiniteScrollDisabled=!1,this.infiniteScrollContainer=null,this.scrollWindow=!0,this.immediateCheck=!1,this.horizontal=!1,this.alwaysCallback=!1,this.fromRoot=!1}ngAfterViewInit(){this.infiniteScrollDisabled||this.setup()}ngOnChanges({infiniteScrollContainer:t,infiniteScrollDisabled:e,infiniteScrollDistance:i}){const n=m(t),o=m(e),s=m(i),r=!o&&!this.infiniteScrollDisabled||o&&!e.currentValue||s;(n||o||s)&&(this.destroyScroller(),r&&this.setup())}setup(){"undefined"!=typeof window&&this.zone.runOutsideAngular(()=>{this.disposeScroller=function(t){const{scrollContainer:e,scrollWindow:i,element:n,fromRoot:u}=t,f=function({windowElement:t,axis:e}){return function(t,e){const i=t.isWindow||e&&!e.nativeElement?e:e.nativeElement;return Object.assign(Object.assign({},t),{container:i})}({axis:e,isWindow:x(t)},t)}({axis:new O(!t.horizontal),windowElement:b(e,i,n,u)}),g=new M({totalToScroll:v(n,f)}),m={up:t.upDistance,down:t.downDistance};return function(t){let e=Object(s.a)(t.container,"scroll");return t.throttle&&(e=e.pipe(function(t,e=h.a,i=d){return n=>n.lift(new p(t,e,i.leading,i.trailing))}(t.throttle))),e}({container:f.container,throttle:t.throttle}).pipe(Object(r.a)(()=>Object(o.a)(v(n,f))),Object(l.a)(t=>function(t,e,i){const{scrollDown:n,fire:o}=function(t,e,i){const n=function(t,e){return t<e.scrolled}(t,e);return{fire:_(e,i,n),scrollDown:n}}(t,e,i);return{scrollDown:n,fire:o,stats:e}}(g.lastScrollPosition,t,m)),Object(c.a)(({stats:t})=>g.updateScroll(t.scrolled,t.totalToScroll)),Object(a.a)(({fire:e,scrollDown:i,stats:{totalToScroll:n}})=>function(t,e,i){return!(!t||!e)||!(i||!e)}(t.alwaysCallback,e,g.isTriggeredScroll(n,i))),Object(c.a)(({scrollDown:t,stats:{totalToScroll:e}})=>{g.updateTriggeredFlag(e,t)}),Object(l.a)(k))}({fromRoot:this.fromRoot,alwaysCallback:this.alwaysCallback,disable:this.infiniteScrollDisabled,downDistance:this.infiniteScrollDistance,element:this.element,horizontal:this.horizontal,scrollContainer:this.infiniteScrollContainer,scrollWindow:this.scrollWindow,throttle:this.infiniteScrollThrottle,upDistance:this.infiniteScrollUpDistance}).subscribe(t=>this.zone.run(()=>this.handleOnScroll(t)))})}handleOnScroll({type:t,payload:e}){switch(t){case"[NGX_ISE] DOWN":return this.scrolled.emit(e);case"[NGX_ISE] UP":return this.scrolledUp.emit(e);default:return}}ngOnDestroy(){this.destroyScroller()}destroyScroller(){this.disposeScroller&&this.disposeScroller.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(n.Kb(n.l),n.Kb(n.A))},t.\u0275dir=n.Fb({type:t,selectors:[["","infiniteScroll",""],["","infinite-scroll",""],["","data-infinite-scroll",""]],inputs:{infiniteScrollDistance:"infiniteScrollDistance",infiniteScrollUpDistance:"infiniteScrollUpDistance",infiniteScrollThrottle:"infiniteScrollThrottle",infiniteScrollDisabled:"infiniteScrollDisabled",infiniteScrollContainer:"infiniteScrollContainer",scrollWindow:"scrollWindow",immediateCheck:"immediateCheck",horizontal:"horizontal",alwaysCallback:"alwaysCallback",fromRoot:"fromRoot"},outputs:{scrolled:"scrolled",scrolledUp:"scrolledUp"},features:[n.xb]}),t})(),K=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=n.Ib({type:t}),t.\u0275inj=n.Hb({providers:[],imports:[[]]}),t})()},xzSE:function(t,e,i){"use strict";i.d(e,"a",function(){return d});var n=i("fXoL"),o=i("yvDh"),s=i("XNvU"),r=i("tyNb"),l=i("ofXK"),c=i("3Pt+"),a=i("Sqts");function u(t,e){if(1&t&&n.Lb(0,"img",18),2&t){const t=n.Yb();n.dc("src",t.me.avatarPath,n.mc)}}function h(t,e){if(1&t){const t=n.Qb();n.Pb(0,"div",19),n.Pb(1,"div",20),n.Pb(2,"div",21),n.Wb("click",function(){return n.lc(t),n.Yb().unPreviewImages()}),n.Ob(),n.Lb(3,"app-photos-container",22),n.Ob(),n.Ob()}if(2&t){const t=n.Yb();n.zb(3),n.dc("photos",t.previewFiles)}}let d=(()=>{class t{constructor(t,e,i){this.postsService=t,this.mediaService=e,this.router=i,this.newPostEvent=new n.n,this.isValid=!1,this.previewFiles=[],this.subs=[],this.postForm={text:"",images:[]}}ngOnInit(){}ngOnDestroy(){this.subs.forEach(t=>{console.log("unsubs"),t.unsubscribe()})}resizeTextarea(t){const e=t.target;e.style.height="auto",e.style.height=e.scrollHeight+"px"}onEnterSubmit(t,e){"Enter"!=e.key||e.shiftKey||(e.preventDefault(),this.onSubmit(t))}onSubmit(t){const e={text:this.postForm.text,mediaDTOs:[]};if(0!=this.postForm.images.length){const t=new FormData;[...this.postForm.images].forEach((e,i)=>{t.set("file"+i,e,e.name)}),this.mediaService.uploadMedia(t).subscribe(t=>{e.mediaDTOs=t,console.log(t),this.subs.push(this.postsService.savePost(e).subscribe(t=>{this.newPostEvent.emit(t)})),this.previewFiles=[]})}else this.postForm.text&&this.subs.push(this.postsService.savePost(e).subscribe(t=>{this.newPostEvent.emit(t)}));this.postForm={text:"",images:[]}}previewImages(t){this.postForm.images=t,this.previewFiles=[];for(let e of t)if(e.type.match("image*")){const t=new FileReader;t.onload=t=>{this.previewFiles.push({id:e.name,mimeType:e.type,path:t.target.result.toString(),size:e.size,creationDate:new Date(e.lastModified)})},t.readAsDataURL(e)}}unPreviewImages(t){this.postForm.images=[],this.previewFiles=[]}}return t.\u0275fac=function(e){return new(e||t)(n.Kb(s.a),n.Kb(o.a),n.Kb(r.b))},t.\u0275cmp=n.Eb({type:t,selectors:[["app-post-maker"]],inputs:{me:"me"},outputs:{newPostEvent:"newPostEvent"},decls:19,vars:4,consts:[[1,"post-maker","flex","fd-r","jc-sb","ai-fs"],[1,"avatar-box","square-48"],["class","square-48","alt","photo",3,"src",4,"ngIf"],[3,"ngSubmit"],["form","ngForm"],["rows","1","name","postText","placeholder","\u0429\u043e \u043d\u043e\u0432\u043e\u0433\u043e?",3,"ngModel","input","ngModelChange"],["class","flex jc-c",4,"ngIf"],[1,"post-maker-footer","flex","ai-fe","jc-sb"],[1,"attach","flex","fd-r","jc-sb"],[1,"add-picture-btn","round","r-20","square-28",3,"click"],["type","file","name","postImages","ngModel","","multiple","",1,"hidden",3,"change"],["input_image",""],[1,"add-music-btn","round","r-20","square-28"],["type","file","name","music",1,"hidden"],[1,"add-video-btn","round","r-22","square-28"],["type","file","name","video",1,"hidden"],[1,"add-emoji-btn","round","r-22","square-28"],["type","submit",1,"submit-btn",3,"disabled"],["alt","photo",1,"square-48",3,"src"],[1,"flex","jc-c"],[1,"preview-container","fg-1"],[1,"close-btn","round","r-16","square-20",3,"click"],["size","large",3,"photos"]],template:function(t,e){if(1&t){const t=n.Qb();n.Pb(0,"section",0),n.Pb(1,"span",1),n.oc(2,u,1,1,"img",2),n.Ob(),n.Pb(3,"form",3,4),n.Wb("ngSubmit",function(){n.lc(t);const i=n.kc(4);return e.onSubmit(i)}),n.Pb(5,"textarea",5),n.Wb("input",function(t){return e.resizeTextarea(t)})("ngModelChange",function(t){return e.postForm.text=t}),n.Ob(),n.oc(6,h,4,1,"div",6),n.Pb(7,"div",7),n.Pb(8,"ul",8),n.Pb(9,"li",9),n.Wb("click",function(){return n.lc(t),n.kc(11).click()}),n.Pb(10,"input",10,11),n.Wb("change",function(){n.lc(t);const i=n.kc(11);return e.previewImages(i.files)}),n.Ob(),n.Ob(),n.Pb(12,"li",12),n.Lb(13,"input",13),n.Ob(),n.Pb(14,"li",14),n.Lb(15,"input",15),n.Ob(),n.Lb(16,"li",16),n.Ob(),n.Pb(17,"button",17),n.qc(18,"\u041e\u043f\u0443\u0431\u043b\u0456\u043a\u0443\u0432\u0430\u0442\u0438"),n.Ob(),n.Ob(),n.Ob(),n.Ob()}2&t&&(n.zb(2),n.dc("ngIf",e.me),n.zb(3),n.dc("ngModel",e.postForm.text),n.zb(1),n.dc("ngIf",e.previewFiles.length>0),n.zb(11),n.dc("disabled",!e.postForm.text&&0==e.postForm.images.length))},directives:[l.k,c.p,c.i,c.j,c.a,c.h,c.k,a.a],styles:[".post-maker[_ngcontent-%COMP%]{margin:15px 0 10px;padding:12px 16px;border-radius:15px;color:#272727;background:#fff}.post-maker[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{flex-basis:624px}.post-maker[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{margin-top:14px;font-size:18px;height:22px}.post-maker[_ngcontent-%COMP%]   .media-box[_ngcontent-%COMP%]{max-height:420px;border-radius:15px;overflow:hidden;margin:15px 0}.post-maker[_ngcontent-%COMP%]   .media-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{-o-object-fit:cover;object-fit:cover;-o-object-position:center;object-position:center;width:40%;max-height:210px;flex-grow:1;margin:0 2px 2px 0}.post-maker[_ngcontent-%COMP%]   .media-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:first-of-type{max-height:420px}.post-maker[_ngcontent-%COMP%]   .avatar-box[_ngcontent-%COMP%]{margin-right:10px;background:#eee}.post-maker[_ngcontent-%COMP%]   .post-maker-footer[_ngcontent-%COMP%]{flex-grow:1}.post-maker[_ngcontent-%COMP%]   .post-maker-footer[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%]{border:none;color:#fff;padding:8px 11px;border-radius:20px;font-weight:700;font-size:15px;outline:none;cursor:pointer;background-color:#3eb2fa}.post-maker[_ngcontent-%COMP%]   .post-maker-footer[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%]:disabled{background-color:#a7d9f8;cursor:auto}.attach[_ngcontent-%COMP%]{list-style:none}.attach[_ngcontent-%COMP%]   .add-picture-btn[_ngcontent-%COMP%]{background-image:url(picture.8bab62ef09da605e0ddf.png)}.attach[_ngcontent-%COMP%]   .add-music-btn[_ngcontent-%COMP%]{background-image:url(add-music.9a4176a08125a911c279.png)}.attach[_ngcontent-%COMP%]   .add-video-btn[_ngcontent-%COMP%]{background-image:url(add-video.07c28269d0df8adddcda.png)}.attach[_ngcontent-%COMP%]   .add-emoji-btn[_ngcontent-%COMP%]{position:relative;background-image:url(emoji.a281a630f75958ce1961.png)}.preview-container[_ngcontent-%COMP%]{position:relative;margin:5px 0}.preview-container[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{position:absolute;right:5px;top:5px;background-image:url(plus-hover.c5a44e580f069dae6603.png);background-color:#fff;transform:rotate(45deg);border:1px solid #eee;outline:none;z-index:10}"]}),t})()}}]);